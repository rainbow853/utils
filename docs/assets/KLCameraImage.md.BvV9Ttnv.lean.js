import{g as _,d as F,E as B}from"./chunks/index.riVPjPFM.js";import{d as T,p as A,B as C,o as w,c as x,G as E,j as y,a as S,a1 as $}from"./chunks/framework.jUpJgIXt.js";const a={},L=function(m){Object.assign(a,m)};class P{constructor(e,t,i){this.width=192,this.height=108,this.scale=1,this.dx=0,this.dy=0,this.isSubscribed=!1,this.camera=e,this.listener=t,this.name=i||Date.now()+"",this.subscribeCb=this.subscribeCb.bind(this)}async subscribeCb(e){this.listener(e,this)}async startSubscribe(e){var t;this.isSubscribed||(await this.camera.addSubscribe(this,e),await((t=a.startSubscribe)==null?void 0:t.call(a,this,this.subscribeCb)),this.isSubscribed=!0)}updateParam(e){var s;const[t,i,r,b,c]=e;this.scale=r,this.dx=b,this.dy=c,this.width=t,this.height=i,this.isSubscribed&&((s=a.updateSubscribe)==null||s.call(a,this))}async stopSubscribe(e){var t;this.isSubscribed&&(await((t=a.stopSubscribe)==null?void 0:t.call(a,this)),this.isSubscribed=!1,await this.camera.removeSubscribe(this,e))}async destorySubscribe(){var e;await this.stopSubscribe(),(e=a.destorySubscribe)==null||e.call(a,this)}async grabImage(e){var t;return(t=a.grabImage)==null?void 0:t.call(a,this,e)}}class G{constructor(e){this.model="",this.sn="",this.name="",this.subscribes=[],this.isGrabing=!1,this.grabType="grabInternal";const{id:t,name:i,model:r,sn:b,width:c,height:s,channel:l}=e;this.id=t,this.model=r,this.sn=b,this.width=c||5120,this.height=s||5120,this.channel=l||1,this.name=i||""}get desc(){return`${this.name}(${this.sn})`}get firstWorkSubscribe(){return this.subscribes.find(e=>e.isSubscribed)}createSubscribe(e,t){const i=new P(this,e,t);return this.subscribes.push(i),i}addSubscribe(e,t){return this.subscribes.indexOf(e)===-1&&this.subscribes.push(e),t?Promise.resolve():this.grabStart()}removeSubscribe(e,t){const i=this.subscribes.indexOf(e);return i===-1||this.subscribes.splice(i,1),t?Promise.resolve():this.grabStop()}async grabStart(){var e;this.isGrabing||(e=a.grabStart)==null||e.call(a,this).then(t=>{this.isGrabing=t}).catch(t=>{this.isGrabing=t})}async grabStop(){var e;this.isGrabing&&((e=a.grabStop)==null||e.call(a,this).then(t=>{this.isGrabing=t}).catch(t=>{this.isGrabing=t}))}async swicthGrabType(e){if(this.grabType===e)return;const t=this.isGrabing;if(t&&await this.grabStop(),this.grabType=e,t)return this.grabStart()}async grabImage(e,t){var i;return t=t||this.firstWorkSubscribe,(i=t==null?void 0:t.grabImage)==null?void 0:i.call(t,e)}async setExposureTime(e){var t;return(t=a.setExposureTime)==null?void 0:t.call(a,this,e)}async getExposureTime(){var e;return(e=a.getExposureTime)==null?void 0:e.call(a,this)}async undistort(e){var t;return(t=a.undistort)==null?void 0:t.call(a,this,e)}removeName(){this.name=""}addName(e){this.name=e}}var f={};const q=_(F);Object.defineProperty(f,"__esModule",{value:!0});var D=f.TransformImageData=void 0;const N=q;class O extends N.TransferToWindow{constructor(e){super(e,!0),this.inData=new Uint32Array(e.inData),this.outData=new Uint32Array(e.outData),this.resize()}update(){const{inw:e,inh:t,inData:i,outw:r,outh:b,outData:c,invScale:s,invDx:l,invDy:o}=this;for(let h=0;h<b;h++){const u=Math.floor(h*s+o);if(u<0||u>=t){c.fill(0,h*r,(h+1)*r);continue}for(let n=0;n<r;n++){const d=Math.floor(n*s+l);let p=h*r+n;if(d<0||d>=e){c[p]=0;continue}let k=u*e+d;c[p]=i[k]}}}translate(e,t,i){super.translate(e,t),i||this.update()}zoom(e,t,i,r){super.zoom(e,t,i),r||this.update()}resize(e){super.resize(),e||this.update()}}D=f.TransformImageData=O;const K={class:"shadow-block p20",style:{height:"600px"}},M=T({__name:"CameraImage",setup(m){L({async grabStart(s){return console.log(`${s.desc}: ${s.grabType} grabStart...`),!0},async grabStop(s){return console.log(`${s.desc}: grabStop...`),!1},async startSubscribe(s,l){console.log(`${s.camera.desc}/${s.name}: startSubscribe...`);const{width:o,height:h}=s,u=new ImageData(o,h),n=new D({inw:i,inh:r,inData:b,outw:o,outh:h,outData:u.data.buffer});n.inData.fill(4285295861);const d=new Uint8Array(n.inData.buffer);function p(){const{scale:k,dx:v,dy:I}=s;n.updateMatrix(k,v,I),d[2]=~~(255*Math.random());for(let g=0;g<r;g++)d[0]=~~(255/r*g),n.inData.fill(n.inData[0],g*i,(g+1)*i);n.update(),l(u),setTimeout(()=>{s.isSubscribed&&p()},100)}p()},async stopSubscribe(s){console.log(`${s.camera.desc}/${s.name}: stopSubscribe...`)},async updateSubscribe(s){console.log(`${s.name}/${s.camera.desc}: updateSubscribe...`)},async destorySubscribe(s){console.log(`${s.name}/${s.camera.desc}: destorySubscribe...`)},async grabImage(s,l){return new ImageData(new Uint8ClampedArray(b),i,r)}});function e(s,l="image.png"){const o=document.createElement("canvas"),h=o.getContext("2d");o.width=s.width,o.height=s.height,h==null||h.putImageData(s,0,0),o.toBlob(u=>{if(!u)return;const n=URL.createObjectURL(u),d=document.createElement("a");d.href=n,d.download=l,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n)})}const t=A(new G({id:1,name:"模拟相机",model:"MODEL",sn:"SN-TEST",width:5120,height:5120,channel:3})),{width:i,height:r}=t.value,b=new ArrayBuffer(i*r*4);function c(s){B.confirm("采集图像已完成，是否下载图像？","采集图像",{confirmButtonText:"确定",showCancelButton:!1}).then(()=>e(s))}return(s,l)=>{const o=C("KLCameraImage");return w(),x("div",K,[E(o,{camera:t.value,grabImageSuccessCB:c},null,8,["camera"])])}}}),V=JSON.parse('{"title":"KLIcon","description":"","frontmatter":{"hello":"world"},"headers":[],"relativePath":"KLCameraImage.md","filePath":"KLCameraImage.md"}'),U={name:"KLCameraImage.md"},R=Object.assign(U,{setup(m){return(e,t)=>(w(),x("div",null,[t[0]||(t[0]=y("h1",{id:"klicon",tabindex:"-1"},[S("KLIcon "),y("a",{class:"header-anchor",href:"#klicon","aria-label":'Permalink to "KLIcon"'},"​")],-1)),t[1]||(t[1]=y("p",null,"考拉实时相机组件",-1)),t[2]||(t[2]=y("h2",{id:"效果",tabindex:"-1"},[S("效果 "),y("a",{class:"header-anchor",href:"#效果","aria-label":'Permalink to "效果"'},"​")],-1)),E(M),t[3]||(t[3]=$('<h2 id="attributes" tabindex="-1">Attributes <a class="header-anchor" href="#attributes" aria-label="Permalink to &quot;Attributes&quot;">​</a></h2><blockquote><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> roi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><p>image为Camera对象grabImage返回的数据</p></blockquote><table tabindex="0"><thead><tr><th>属性</th><th>说明</th><th>类型</th><th style="text-align:center;">默认值</th></tr></thead><tbody><tr><td>camera</td><td>相机实例</td><td><a href="https://github.com/fengqing1101/kl-camera-frontend" target="_blank" rel="noreferrer">Camera</a></td><td style="text-align:center;">-</td></tr><tr><td>showCrosshair</td><td>鼠标位置显示十字线</td><td><code>boolean</code></td><td style="text-align:center;">false</td></tr><tr><td>grabImageSuccessCB</td><td>采集图像后回调函数</td><td><code>(image: image) =&gt; void</code></td><td style="text-align:center;">-</td></tr><tr><td>helpVideo</td><td>帮助视频地址</td><td>string</td><td style="text-align:center;">-</td></tr><tr><td>rectCallback</td><td>鼠标右键绘制矩阵框回调函数</td><td><code>(roi: roi) =&gt; boolean</code></td><td style="text-align:center;">-</td></tr></tbody></table><h2 id="slot" tabindex="-1">slot <a class="header-anchor" href="#slot" aria-label="Permalink to &quot;slot&quot;">​</a></h2><table tabindex="0"><thead><tr><th>插槽名</th><th>说明</th><th>数据</th></tr></thead><tbody><tr><td>default</td><td>图像区域内部并返回画布缩放比例与宽高</td><td><code>{scale: number, width: number, height: number}</code></td></tr><tr><td>camera-outer</td><td>图像所在画布</td><td>-</td></tr></tbody></table><h2 id="方法" tabindex="-1">方法 <a class="header-anchor" href="#方法" aria-label="Permalink to &quot;方法&quot;">​</a></h2><table tabindex="0"><thead><tr><th>方法名</th><th style="text-align:center;">参数</th><th>说明</th></tr></thead><tbody><tr><td>getPosition</td><td style="text-align:center;"><code>(e: MouseEvent, limitInWindow?: boolean) =&gt; number[]</code></td><td>获取鼠标在图像中的坐标</td></tr><tr><td>restoreImage</td><td style="text-align:center;"><code>() =&gt; void</code></td><td>重置图像区域</td></tr></tbody></table>',7))]))}});export{V as __pageData,R as default};
