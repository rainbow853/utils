import{d as _,p as W,B as $,o as I,c as v,G as T,w as k,a as x,j as S,a1 as P}from"./chunks/framework.CVqx_5xG.js";const h={},z=function(c){Object.assign(h,c)};class G{constructor(e,t,s){this.width=192,this.height=108,this.scale=1,this.dx=0,this.dy=0,this.isSubscribed=!1,this.camera=e,this.listener=t,this.name=s||Date.now()+"",this.subscribeCb=this.subscribeCb.bind(this)}async subscribeCb(e){this.listener(e,this)}async startSubscribe(e){var t;this.isSubscribed||(await this.camera.addSubscribe(this,e),await((t=h.startSubscribe)==null?void 0:t.call(h,this,this.subscribeCb)),this.isSubscribed=!0)}updateParam(e){var n;const[t,s,i,a,r]=e;this.scale=i,this.dx=a,this.dy=r,this.width=t,this.height=s,this.isSubscribed&&((n=h.updateSubscribe)==null||n.call(h,this))}async stopSubscribe(e){var t;this.isSubscribed&&(await((t=h.stopSubscribe)==null?void 0:t.call(h,this)),this.isSubscribed=!1,await this.camera.removeSubscribe(this,e))}async destorySubscribe(){var e;await this.stopSubscribe(),(e=h.destorySubscribe)==null||e.call(h,this)}async grabImage(e){var t;return(t=h.grabImage)==null?void 0:t.call(h,this,e)}}class O{constructor(e){this.model="",this.sn="",this.name="",this.subscribes=[],this.isGrabing=!1,this.grabType="grabInternal";const{id:t,name:s,model:i,sn:a,width:r,height:n,channel:o}=e;this.id=t,this.model=i,this.sn=a,this.width=r||5120,this.height=n||5120,this.channel=o||1,this.name=s||""}get desc(){return`${this.name}(${this.sn})`}get firstWorkSubscribe(){return this.subscribes.find(e=>e.isSubscribed)}createSubscribe(e,t){const s=new G(this,e,t);return this.subscribes.push(s),s}addSubscribe(e,t){return this.subscribes.indexOf(e)===-1&&this.subscribes.push(e),t?Promise.resolve():this.grabStart()}removeSubscribe(e,t){const s=this.subscribes.indexOf(e);return s===-1||this.subscribes.splice(s,1),t?Promise.resolve():this.grabStop()}async grabStart(){var e;this.isGrabing||(e=h.grabStart)==null||e.call(h,this).then(t=>{this.isGrabing=t}).catch(t=>{this.isGrabing=t})}async grabStop(){var e;this.isGrabing&&((e=h.grabStop)==null||e.call(h,this).then(t=>{this.isGrabing=t}).catch(t=>{this.isGrabing=t}))}async swicthGrabType(e){if(this.grabType===e)return;const t=this.isGrabing;if(t&&await this.grabStop(),this.grabType=e,t)return this.grabStart()}async grabImage(e,t){var s;return t=t||this.firstWorkSubscribe,(s=t==null?void 0:t.grabImage)==null?void 0:s.call(t,e)}async setExposureTime(e){var t;return(t=h.setExposureTime)==null?void 0:t.call(h,this,e)}async getExposureTime(){var e;return(e=h.getExposureTime)==null?void 0:e.call(h,this)}async undistort(e){var t;return(t=h.undistort)==null?void 0:t.call(h,this,e)}removeName(){this.name=""}addName(e){this.name=e}}var g={},b={};Object.defineProperty(b,"__esModule",{value:!0});b.default=b.TransferToWindow=void 0;class D{constructor(e,t){const{inw:s,inh:i,outw:a,outh:r,minWH:n,maxWH:o,limitInWindow:l,limitSize:d}=e;this.inw=s,this.inh=i,this.outw=a,this.outh=r,this.minWH=n||1,this.maxWH=o||1/0,this.minScale=this.maxScale=1,this.limitInWindow=l||!1,this.limitSize=d??100,t||this.resize()}translate(e,t){this.updateMatrix(this.scale,this.dx+e,this.dy+t)}zoom(e,t,s){const{dx:i,dy:a,scale:r,minScale:n,maxScale:o}=this;r*s>o?s=o/r:r*s<n&&(s=n/r),this.updateMatrix(r*s,(i-e)*s+e,(a-t)*s+t)}zoomToByInCoor(e,t,s){const{outw:i,outh:a,minScale:r,maxScale:n}=this;s=Math.min(n,Math.max(r,s)),this.updateMatrix(s,i/2-e*s,a/2-t*s)}resize(){const{outw:e,outh:t,inw:s,inh:i,minWH:a,maxWH:r}=this;let n;e/t>s/i?n=t/i:n=e/s,this.minScale=Math.min(n,a/s,a/i),this.maxScale=Math.max(n,r/s,r/i),this.updateMatrix(n,(e-s*n)/2,(t-i*n)/2)}scrollToRect(e,t,s,i,a){a=a??100;const{outw:r,outh:n}=this,o=Math.min(r/(s+a),n/(i+a));this.zoomToByInCoor(e+s/2,t+i/2,o)}updateMatrix(e,t,s){if(this.limitInWindow){const{inw:i,inh:a,outw:r,outh:n,limitSize:o}=this;t=Math.min(r-o,Math.max(-i*e+o,t)),s=Math.min(n-o,Math.max(-a*e+o,s))}this.scale=e,this.dx=t,this.dy=s,this.updateInvMatrix()}updateInvMatrix(){this.invScale=1/this.scale,this.invDx=-this.dx/this.scale,this.invDy=-this.dy/this.scale}inCoorIsIn(e,t){const{inw:s,inh:i}=this;return e>=0&&e<s&&t>=0&&t<i}outCoorIsIn(e,t){const{outw:s,outh:i}=this;return e>=0&&e<s&&t>=0&&t<i}transCoors(e,t,s,i){const a=[];for(let r=1;r<e.length;r=r+2)a.push(~~(e[r-1]*t+s),~~(e[r]*t+i));return a}transInToOut(e){const{scale:t,dx:s,dy:i}=this;return this.transCoors(e,t,s,i)}transOutToIn(e){const{invScale:t,invDx:s,invDy:i}=this;return this.transCoors(e,t,s,i)}}b.TransferToWindow=D;b.default=D;Object.defineProperty(g,"__esModule",{value:!0});var M=g.TransformImageData=void 0;const L=b;class E extends L.TransferToWindow{constructor(e){super(e,!0),this.inData=new Uint32Array(e.inData),this.outData=new Uint32Array(e.outData),this.resize()}update(){const{inw:e,inh:t,inData:s,outw:i,outh:a,outData:r,invScale:n,invDx:o,invDy:l}=this;for(let d=0;d<a;d++){const m=Math.floor(d*n+l);if(m<0||m>=t){r.fill(0,d*i,(d+1)*i);continue}for(let u=0;u<i;u++){const p=Math.floor(u*n+o);let y=d*i+u;if(p<0||p>=e){r[y]=0;continue}let w=m*e+p;r[y]=s[w]}}}translate(e,t,s){super.translate(e,t),s||this.update()}zoom(e,t,s,i){super.zoom(e,t,s),i||this.update()}resize(e){super.resize(),e||this.update()}}M=g.TransformImageData=E;const K={class:"shadow-block p20",style:{height:"400px"}},N=_({__name:"CameraImage",setup(c){z({async grabStart(a){return console.log(`${a.desc}: ${a.grabType} grabStart...`),!0},async grabStop(a){return console.log(`${a.desc}: grabStop...`),!1},async startSubscribe(a,r){console.log(`${a.camera.desc}/${a.name}: startSubscribe...`);const{width:n,height:o}=a,l=new ImageData(n,o),d=new M({inw:t,inh:s,inData:i,outw:n,outh:o,outData:l.data.buffer});d.inData.fill(4285295861);const m=new Uint8Array(d.inData.buffer);function u(){const{scale:p,dx:y,dy:w}=a;d.updateMatrix(p,y,w),m[2]=~~(255*Math.random());for(let f=0;f<s;f++)m[0]=~~(255/s*f),d.inData.fill(d.inData[0],f*t,(f+1)*t);d.update(),r(l),setTimeout(()=>{a.isSubscribed&&u()},100)}u()},async stopSubscribe(a){console.log(`${a.camera.desc}/${a.name}: stopSubscribe...`)},async updateSubscribe(a){console.log(`${a.name}/${a.camera.desc}: updateSubscribe...`)},async destorySubscribe(a){console.log(`${a.name}/${a.camera.desc}: destorySubscribe...`)}});const e=W(new O({id:1,name:"模拟相机",model:"MODEL",sn:"SN-TEST",width:5120,height:5120,channel:3})),{width:t,height:s}=e.value,i=new ArrayBuffer(t*s*4);return(a,r)=>{const n=$("KLCameraImage");return I(),v("div",K,[T(n,{camera:e.value},{footer:k(()=>r[0]||(r[0]=[x("-")])),_:1},8,["camera"])])}}}),j=JSON.parse('{"title":"KLIcon","description":"","frontmatter":{"hello":"world"},"headers":[],"relativePath":"KLCameraImage.md","filePath":"KLCameraImage.md"}'),q={name:"KLCameraImage.md"},A=Object.assign(q,{setup(c){return(e,t)=>(I(),v("div",null,[t[0]||(t[0]=S("h1",{id:"klicon",tabindex:"-1"},[x("KLIcon "),S("a",{class:"header-anchor",href:"#klicon","aria-label":'Permalink to "KLIcon"'},"​")],-1)),t[1]||(t[1]=S("p",null,"考拉实时相机组件",-1)),t[2]||(t[2]=S("h2",{id:"效果",tabindex:"-1"},[x("效果 "),S("a",{class:"header-anchor",href:"#效果","aria-label":'Permalink to "效果"'},"​")],-1)),T(N),t[3]||(t[3]=P('<h2 id="attributes" tabindex="-1">Attributes <a class="header-anchor" href="#attributes" aria-label="Permalink to &quot;Attributes&quot;">​</a></h2><table tabindex="0"><thead><tr><th>属性</th><th>说明</th><th>类型</th><th style="text-align:center;">默认值</th></tr></thead><tbody><tr><td>name</td><td>相机实例</td><td><a href="https://github.com/fengqing1101/kl-camera-frontend" target="_blank" rel="noreferrer">Camera</a></td><td style="text-align:center;">-</td></tr><tr><td>showCrosshair</td><td>鼠标位置显示十字线</td><td><code>boolean</code></td><td style="text-align:center;">false</td></tr><tr><td>showItemInFolder</td><td>采集图像后打开图像所在目录的回调函</td><td><code>(imgPath: string) =&gt; void</code></td><td style="text-align:center;">false</td></tr></tbody></table><h2 id="slot" tabindex="-1">slot <a class="header-anchor" href="#slot" aria-label="Permalink to &quot;slot&quot;">​</a></h2><table tabindex="0"><thead><tr><th>插槽名</th><th>说明</th></tr></thead><tbody><tr><td>default</td><td>图像区域内部</td></tr><tr><td>camera-outer</td><td>图像所在画布</td></tr><tr><td>footer</td><td>右下角</td></tr></tbody></table><h2 id="方法" tabindex="-1">方法 <a class="header-anchor" href="#方法" aria-label="Permalink to &quot;方法&quot;">​</a></h2><table tabindex="0"><thead><tr><th>方法名</th><th style="text-align:center;">参数</th><th>说明</th></tr></thead><tbody><tr><td>getPosition</td><td style="text-align:center;"><code>(e: MouseEvent, limitInWindow?: boolean) =&gt; number[]</code></td><td>获取鼠标在图像中的坐标</td></tr></tbody></table>',6))]))}});export{j as __pageData,A as default};
